# Rust
<!--
## Build

There are four GN target templates that should be used for Rust projects:

- [`rustc_library`][target-library-rustc] defines a library and optionally a
  unit test target. The library can be depended on by other targets.
- [`rustc_binary`][target-binary-rustc] defines an executable and optionally a
  unit test target.
- [`rustc_test`][target-test-rustc] defines a test-only target.
- [`rustc_macro`][target-macro-rustc] defines a
  [procedural macro][rust-proc-macros] target.

The [examples/rust][rust-examples] directory has some examples of Rust
packages that use these targets, as do the [Rust FIDL examples][fidl-tutorial].

Note: The example [Rust BUILD.gn file](/examples/rust/BUILD.gn)
contains the line `group("rust")`. In this instance, `rust` refers to the directory
the `.gn` file is in, not the language.
-->

## 构建

有4种 GN 目标模板可以应用在 Rust 工程中：
- [`rustc_library`][target-library-rustc] 定义一个库应用并可选一个单元测试目标。库应用可以被其它目标所依赖。
- [`rustc_binary`][target-binary-rustc] 定义一个可执行应用并可选一个单元测试目标。
- [`rustc_test`][target-test-rustc] 定义一个仅测试目标。
- [`rustc_macro`][target-macro-rustc] 定义一个
  [过程宏][rust-proc-macros] 目标。

在 [examples/rust][rust-examples] 目录下有一些 Rust 包示例用到这些目标，比如 [Rust FIDL examples][fidl-tutorial] 。

注意：示例 [Rust BUILD.gn 文件](/examples/rust/BUILD.gn) 包含了一行 `group(rust)` ，这里的 `rust` 是指 `.gn` 文件所在的目录，而不是指 rust 语言。

<!--
### Building with a custom toolchain

If you want to test out Fuchsia with your own custom-built versions of rustc or
cargo, you can set the `rustc_prefix` argument to `fx set`, like this:

```
fx set core.x64 --release --args "rustc_prefix=\"/path/to/bin/dir\""
```
-->

### 自定义工具链构建

如果你想在 Fuchsia 测试你自己编译的 rustc 或 cargo 版本，可以给 `fx set` 设置 `rustc_prefix` 参数，比如：
```
fx set core.x64 --release --args "rustc_prefix=\"/path/to/bin/dir\""
```

<!--
## Cargo.toml

Fuchsia Rust targets are not built with cargo. That said, you can
[generate Cargo.toml files](cargo.md) for use with external tooling. This
functionality is not guaranteed to work.
-->

## Cargo.toml

Fuchsia 的 Rust 目标并非由 cargo 构建而来。也就是说，你可以[生成 Cargo.toml 文件](cargo.md)用于外部工具。这个功能不能保证正常工作。

<!--
### Autogenerated documentation

Once you have a Cargo.toml for your target you can generate and browse HTML
documentation for your target and its dependencies by running:

```sh
fx rustdoc path/from/fuchsia/root/to/target:label --open
```
-->

### 自动生成文档

只要你的目标有一个 Cargo.toml 文件，就可以运行下面的脚本来生成和浏览目标文档：

```sh
fx rustdoc path/from/fuchsia/root/to/target:label --open
```

<!--
## Tests

You can run unit tests on connected devices using `fx`, with the `fx test
{package name}` command.  See [Testing Rust code](testing.md) for information
on adding and running tests.
-->

## 测试

你可以在已连接设备上使用 `fx` 来运行单元测试，具体是 `fx test
{package name}` 命令。关于增加和运行测试，请参考 [Testing Rust code](testing.md) 获取更多信息。

<!--
## Procedural macros

Procedural macro targets are executed on the host at compile time. Therefore,
they cannot depend on other crates that are only available on device, e.g.
zircon.

Negative tests, e.g. asserting that a macro fails to compile with a specific
error, are currently not supported.
-->

## 过程宏

过程宏目标在编译阶段就在主机上运行了。因此，它们不能依赖于其它只可用于设备上的 crates ，比如
zircon 。

负面测试，比如断言某个特定的错误导致宏编译失败，当前是不支持的。

<!--
## Warnings and errors

By default our build configuration makes all Rust warnings into errors. This requirement can be
onerous during development, and on your local machine you may wish to see warnings as warnings and
let CQ enforce the hard boundary.

The `rust_cap_lints` GN arg allows you to control this behavior in your development environment.
Setting `rust_cap_lints = "warn"` in `fx args` or adding `--args='rust_cap_lints = "warn"'` to
your `fx set` will allow you to develop locally without being blocked by warnings.
-->

## 告警和错误

我们的构建配置会默认把所有的 Rust 告警当成错误来处理。这个要求在开发过程中很繁重， 而你希望在你的本地机器上看到的是告警就是告警，从而让 CQ 强制执行硬边界。

GN 参数 `rust_cap_lints` 允许你在你的开发环境中控制这个行为。
在 `fx args` 中设置 `rust_cap_lints = "warn"` 或把 `--args='rust_cap_lints = "warn"'` 添加到你的 `fx set` 将允许你在本地开发时不会受阻于告警。


<!--
## Style

We don't currently have a style guide for Rust, but you should run `fx rustfmt`
or `fx format-code` before submitting. We mostly use the rustfmt defaults, but
have a couple [custom settings][rustfmt-toml].
-->

## 样式

当前我们没有针对 Rust 的样式向导，但是在提交之前，你应该运行 `fx rustfmt` 或 `fx format-code` 。大多数情况下我们默认使用 rustfmt ，但是也有一些[自定义设置][rustfmt-toml]

<!--
## Rust Idiomatic Usage Review

If you're new to Rust, and would like someone to review your changes to
validate that your usage of Rust is idiomatic, contact one of the following
(or add them as a reviewer to your change.)

- adamperry@google.com
- belgum@google.com
- dnordstrom@google.com
- jamuraa@google.com
- nickpollard@google.com
- tmandry@google.com

(To volunteer for this, please add yourself to the list above and upload the
change with one of the above as the reviewer).
-->

## Rust 惯用语使用审查

如果你是 Rust 新手，希望有人来审查你的修改以验证你使用的是 Rust 惯用语，可以联系下边的人（或者添加他们，让他们成为你的修改的审查员。）

- adamperry@google.com
- belgum@google.com
- dnordstrom@google.com
- jamuraa@google.com
- nickpollard@google.com
- tmandry@google.com

（想要成为志愿审查员，请把你自己添加到上边的联系人列表，并以审查员身份上传上边所做的修改）。

<!--
## Communication channels

Public discussion happens on the [rust-users@fuchsia.dev] mailing list.

{% dynamic if user.is_googler %}

**[Googlers only]** For Googler-only channels, see
[go/fuchsia-rust-googlers].

{% dynamic endif %}
-->

## 交流渠道

公共讨论一般都发生在 [rust-users@fuchsia.dev] 邮件列表上。

{% dynamic if user.is_googler %}

**[Googlers only]** 是谷歌用户专用通道，请看 [go/fuchsia-rust-googlers] 。

{% dynamic endif %}

<!--
## Existing Fuchsia Rust libraries

- [List of crates](crates.md)
- [Autogenerated documentation for crates](https://fuchsia-docs.firebaseapp.com)
-->

## 当前存在的 Fuchsia 上使用的 Rust 库

- [crates 列表](crates.md)
- [自动生成的 crates 文档](https://fuchsia-docs.firebaseapp.com)


<!--
## Going further

- [Editor setup](editors.md)
- [Measuring binary bloat](bloat.md)
- [Managing external dependencies](external_crates.md)
- [Unsafe code](unsafe.md)
- [Unstable features](unstable.md)
- [Rust FIDL server/client tutorial][fidl-tutorial]
- [Logging](logging.md)
- [Add logging to hello world](add-logging.md)
-->

## 扩展

- [编辑器设置](editors.md)
- [测量二进制膨胀](bloat.md)
- [管理外部依赖](external_crates.md)
- [非安全代码](unsafe.md)
- [不稳定功能](unstable.md)
- [Rust FIDL server/client 教程][fidl-tutorial]
- [日志](logging.md)
- [给 hello world 添加日志](add-logging.md)



[target-library-rustc]: /build/rust/rustc_library.gni "Rust library"
[target-binary-rustc]: /build/rust/rustc_binary.gni "Rust binary"
[target-test-rustc]: /build/rust/rustc_test.gni "Rust test"
[target-macro-rustc]: /build/rust/rustc_macro.gni "Rust proc macro"
[rust-examples]: /examples/rust/
[fargo]: https://fuchsia.googlesource.com/fargo
[rustfmt-install]: https://github.com/rust-lang-nursery/rustfmt#quick-start
[rustfmt-toml]: /rustfmt.toml
[fidl-tutorial]: /docs/development/languages/fidl/tutorials/rust
[rust-users@fuchsia.dev]: https://groups.google.com/a/fuchsia.dev/g/rust-users
[go/fuchsia-rust-googlers]: https://goto.google.com/fuchsia-rust-googlers
[rust-proc-macros]: https://doc.rust-lang.org/reference/procedural-macros.html
